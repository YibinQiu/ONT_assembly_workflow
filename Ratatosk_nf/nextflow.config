params {

    in_lr_bam = ''
    in_lr_fq = ''

    in_sr_bam = ''
    in_sr_fq = ''

    out_dir = ''

    max_lr_bq = 40
}

profiles {

	standard {

		process {

			executor = 'local'
                        conda = 'assemble_env'

		            withLabel: small_node {
		                cpus = 4
		                memory = { 4.GB * task.cpus * task.attempt }
		            }

			withLabel: medium_node {
				cpus = 6
				memory = { 4.GB * task.cpus * task.attempt }
			}

			withLabel: large_node {
				cpus = 24
				memory = { 4.GB * task.cpus * task.attempt }
			}
		}
	}

	cluster {

		process {

			executor = 'slurm'
                        clusterOptions = '--account=szzx --qos=nolimit --partition=cpu-low-mem,cpu-high-mem -t 148:00:00'
                        conda = 'assemble_env'			

		    withLabel: small_node {
		        cpus = 16
		        memory = { 4.GB * task.cpus * task.attempt }
		        clusterOptions = '--account=szzx --qos=nolimit --partition=cpu-low-mem,cpu-high-mem,fat,fat-8253,cpu-6226 -t 148:00:00'
		            }

			withLabel: medium_node {
				cpus = 32
				memory = { 4.GB * task.cpus * task.attempt }
				clusterOptions = '--account=szzx --qos=nolimit --partition=cpu-low-mem,cpu-high-mem,fat,fat-8253,gpu -t 148:00:00'
			}

			withLabel: large_node {
				cpus = 64
				memory = { 7.GB * task.cpus * task.attempt }
				clusterOptions = '--account=szzx --qos=nolimit --partition=cpu-low-mem,cpu-high-mem,fat-8253 -t 148:00:00'
			}
		}
	}
}

process {

    maxRetries = 2
    conda = 'assemble_env'
    withName:'chunkLR|extractSR' {
        time = { 6.h * task.attempt }
    }

    withName:'buildIndex_1|buildIndex_2' {
        time = { 120.h * task.attempt }
    }

    withName:'correctChunk_1|correctChunk_2' {
        time = { 24.h * task.attempt }
    }

    withName:mergeCorrectedChunks {
        time = { 3.h * task.attempt }
    }
}

includeConfig 'config/tools.config'
includeConfig 'config/pipeline.config'
